<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Title</title>
    <link rel="stylesheet" href="./css/d-trello.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Lato"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
      body {
        font-family: "Lato";
        margin: 0;
        padding: 0;
      }

      #dTrello {
        overflow-x: auto;
        padding: 20px 0;
      }

      .kanban-board-header {
         background-color: grey;
      }

      .success {
        background: #00b961;
      }

      .info {
        background: #2a92bf;
      }

      .warning {
        background: #f4ce46;
      }

      .error {
        background: #fb7d44;
      }

      .custom-button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 7px 15px;
        margin: 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
      }      
    </style>
  </head>
  <body>
    <header>
      <input type="search" name="" id="">
    </header>
    <div id="dTrello"></div>
    <!-- <br />
    <button id="addToDo">Add element in "To Do" Board</button>
    <br />
    <button id="addToDoAtPosition">Add element in "To Do" Board at position 2</button>
    <br />
    <button id="removeBoard">Remove "Done" Board</button>
    <br />
    <button id="removeElement">Remove "My Task Test"</button> -->
    <button id="addNewBoard">Adicionar novo quadro</button>
    <script src="./js/d-trello.js"></script>
    <script src="drag_auto_scroll.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      var KanbanManager = new dTrello({
        element: "#dTrello",
        gutter: "10px",
        widthBoard: "450px",
        itemHandleOptions:{
          enabled: true,
        },
        click: function(el) {
          console.log("Trigger on all items click!");
        },
        context: function(el, e) {
          console.log("Trigger on all items right-click!");
        },
        dropEl: function(el, target, source, sibling){
          console.log(target.parentElement.getAttribute('data-id'));
          console.log(el, target, source, sibling)
        },
        buttonClick: function(el, boardId) {
          console.log(el);
          console.log(boardId);
          // create a form to enter element
          var formItem = document.createElement("form");
          formItem.setAttribute("class", "itemform");
          formItem.innerHTML =
            '<div class="form-group"><textarea class="form-control" rows="2" autofocus></textarea></div><div class="form-group"><button type="submit" class="btn btn-primary btn-xs pull-right">Submit</button><button type="button" id="CancelBtn" class="btn btn-default btn-xs pull-right">Cancel</button></div>';

          KanbanManager.addForm(boardId, formItem);
          formItem.addEventListener("submit", function(e) {
            e.preventDefault();
            var text = e.target[0].value;
            if (text) {
              KanbanManager.addElement(boardId, {
              title: text
            });
              formItem.parentNode.removeChild(formItem);
            } else {
              Swal.fire({
                title: 'Insira um nome para o novo card!',          
              })
            }
          });
          document.getElementById("CancelBtn").onclick = function() {
            formItem.parentNode.removeChild(formItem);
          };
        },
        itemAddOptions: {
          enabled: true,
          content: '+ Add New Card',
          class: 'custom-button',
          footer: true
        },
        boards: [
          {
            id: "_todo",
            title: "A fazer <i class='ph-pencil-fill'></i>",
            class: "info,good",
            dragTo: ["_working"],
            item: []
          },
          {
            id: "_working",
            title: "Fazendo <i class='ph-pencil-fill'></i>",
            class: "warning",
            item: []
          },
          {
            id: "_done",
            title: "Feito <i class='ph-pencil-fill'></i>",
            class: "success",
            dragTo: ["_working"],
            item: []
          }
        ]
      });

      // var toDoButton = document.getElementById("addToDo");
      // toDoButton.addEventListener("click", function() {
      //   KanbanManager.addElement("_todo", {
      //     title: "Test Add"
      //   });
      // });

      // var toDoButtonAtPosition = document.getElementById("addToDoAtPosition");
      // toDoButtonAtPosition.addEventListener("click", function() {
      //   KanbanManager.addElement("_todo", {
      //     title: "Test Add at Pos"
      //   }, 1);
      // });

      const nameNewBoard = () => {
        Swal.fire({
          title: 'DÃª um nome ao novo quadro:',
          input: 'text',
          showCancelButton: true,
          inputValue:""
      }).then(boardName=>{
          if(boardName.value === "") {
            nameNewBoard()
          } else {
              if(boardName.isConfirmed === true) {
                KanbanManager.addBoards([
                  {
                    id: boardName.value,
                    title: boardName.value,
                    item: []
                  }
            ]); 
              }
          }
        })         
      }

      var addBoard = document.getElementById("addNewBoard");
      addBoard.addEventListener("click", nameNewBoard);

      // KanbanManager.addBoards([
      //       {
      //         id: boardName.value,
      //         title: boardName.value,
      //         item: []
      //       }
      //     ]); 
    
      // const itens = document.querySelectorAll('.ph-trash-fill')
      // console.log(itens)
      // itens.forEach(item=>item.addEventListener('click', alert('oii')))

      // var removeBoard = document.getElementById("removeBoard");
      // removeBoard.addEventListener("click", function() {
      //   KanbanManager.removeBoard("_done");
      // });

      // var removeElement = document.getElementById("removeElement");
      // removeElement.addEventListener("click", function() {
      //   KanbanManager.removeElement("_test_delete");
      // });

      var allEle = KanbanManager.getBoardElements("_todo");
      allEle.forEach(function(item, index) {
        // console.log(item);
      });

      //This function receive a card element as argument and opens a confirm modal. If the confirm button is clicked, the card will be removed.
      const confirmRemoveCard = (cardId) => {
        Swal.fire({
          title: 'Gostaria realmente de deletar este card?',
          showCancelButton: true,
      }).then(button=> button.isConfirmed === true && cardId.remove())
    }
    </script>
  </body>
</html>
